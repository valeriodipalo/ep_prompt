<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Style System Demo</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .color-style-picker {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen py-8">
    <div id="color-style-demo"></div>

    <script type="text/babel">
        // Import the color system types and data
        const HairColorTypes = {
            // Color families
            BLACK: 'black',
            BRUNETTE: 'brunette',
            BLONDE: 'blonde',
            RED: 'red',
            AUBURN: 'auburn',
            GRAY: 'gray',
            PLATINUM: 'platinum',
            FASHION: 'fashion',
            PASTEL: 'pastel',
            VIBRANT: 'vibrant'
        };

        // Professional hair color palette
        const colorPalette = [
            // FREE NATURAL COLORS
            { id: 'jet-black', name: 'Jet Black', hex: '#0A0A0A', family: 'black', isPremium: false, description: 'Deep, rich black with blue undertones' },
            { id: 'dark-brown', name: 'Dark Brown', hex: '#2F1B14', family: 'brunette', isPremium: false, description: 'Rich, deep brown' },
            { id: 'medium-brown', name: 'Medium Brown', hex: '#5D4037', family: 'brunette', isPremium: false, description: 'Versatile medium brown' },
            { id: 'light-brown', name: 'Light Brown', hex: '#8D6E63', family: 'brunette', isPremium: false, description: 'Soft, light brown' },
            { id: 'golden-blonde', name: 'Golden Blonde', hex: '#DAA520', family: 'blonde', isPremium: false, description: 'Classic golden blonde' },
            { id: 'auburn', name: 'Auburn', hex: '#A52A2A', family: 'red', isPremium: false, description: 'Classic auburn red' },
            { id: 'salt-pepper', name: 'Salt & Pepper', hex: '#808080', family: 'gray', isPremium: false, description: 'Natural gray blend' },
            
            // PREMIUM COLORS
            { id: 'honey-blonde', name: 'Honey Blonde', hex: '#D4A574', family: 'blonde', isPremium: true, description: 'Warm honey-toned blonde' },
            { id: 'ash-blonde', name: 'Ash Blonde', hex: '#C4A484', family: 'blonde', isPremium: true, description: 'Cool-toned ash blonde' },
            { id: 'platinum-blonde', name: 'Platinum Blonde', hex: '#E5E4E2', family: 'platinum', isPremium: true, description: 'Ultra-light platinum' },
            { id: 'rose-gold', name: 'Rose Gold', hex: '#E8B4B8', family: 'fashion', isPremium: true, description: 'Trendy rose gold' },
            { id: 'pastel-pink', name: 'Pastel Pink', hex: '#FFB6C1', family: 'pastel', isPremium: true, description: 'Soft pastel pink' },
            { id: 'lavender', name: 'Lavender', hex: '#E6E6FA', family: 'pastel', isPremium: true, description: 'Soft lavender purple' },
            { id: 'electric-blue', name: 'Electric Blue', hex: '#7DF9FF', family: 'vibrant', isPremium: true, description: 'Bold electric blue' },
            { id: 'neon-green', name: 'Neon Green', hex: '#39FF14', family: 'vibrant', isPremium: true, description: 'Bright neon green' },
        ];

        // Color presets
        const presets = [
            {
                id: 'classic-brunette',
                label: 'Classic Brunette',
                description: 'Timeless medium brown',
                choice: { type: 'single-tone', singleTone: { colorId: 'medium-brown' } }
            },
            {
                id: 'honey-balayage',
                label: 'Honey Balayage',
                description: 'Brown base with honey highlights',
                choice: {
                    type: 'accented',
                    accented: {
                        baseColorId: 'medium-brown',
                        accentColorId: 'honey-blonde',
                        technique: 'balayage',
                        intensity: 'standard',
                        placement: 'face-framing',
                        blend: 'soft'
                    }
                }
            },
            {
                id: 'platinum-highlights',
                label: 'Platinum Highlights',
                description: 'Bold platinum on dark base',
                choice: {
                    type: 'accented',
                    accented: {
                        baseColorId: 'dark-brown',
                        accentColorId: 'platinum-blonde',
                        technique: 'highlights',
                        intensity: 'bold',
                        placement: 'overall',
                        blend: 'defined'
                    }
                }
            }
        ];

        // Utility functions
        const getContrast = (baseHex, accentHex) => {
            // Simplified contrast calculation
            const getLum = (hex) => {
                const rgb = parseInt(hex.slice(1), 16);
                const r = (rgb >> 16) & 0xff;
                const g = (rgb >> 8) & 0xff;
                const b = (rgb >> 0) & 0xff;
                return 0.2126 * r + 0.7152 * g + 0.0722 * b;
            };
            
            const lum1 = getLum(baseHex);
            const lum2 = getLum(accentHex);
            const brightest = Math.max(lum1, lum2);
            const darkest = Math.min(lum1, lum2);
            return (brightest + 0.05) / (darkest + 0.05);
        };

        const suggestAccents = (baseId) => {
            const baseColor = colorPalette.find(c => c.id === baseId);
            if (!baseColor) return [];
            
            return colorPalette
                .filter(c => c.id !== baseId && getContrast(baseColor.hex, c.hex) >= 2)
                .slice(0, 6);
        };

        const toPrompt = (choice) => {
            if (choice.type === 'single-tone' && choice.singleTone) {
                const color = colorPalette.find(c => c.id === choice.singleTone.colorId);
                return color ? `Professional salon single-process hair color: ${color.name.toLowerCase()}, ${color.description}. Maintain the existing hairstyle and cut shape.` : 'Natural hair color';
            }
            
            if (choice.type === 'accented' && choice.accented) {
                const baseColor = colorPalette.find(c => c.id === choice.accented.baseColorId);
                const accentColor = colorPalette.find(c => c.id === choice.accented.accentColorId);
                
                if (baseColor && accentColor) {
                    return `Professional salon hair coloring: ${baseColor.name.toLowerCase()} base color with ${accentColor.name.toLowerCase()} ${choice.accented.technique}, applied with ${choice.accented.intensity} intensity, ${choice.accented.placement} placement, ${choice.accented.blend} blend. Maintain the existing hairstyle and cut shape.`;
                }
            }
            
            return 'Natural hair color';
        };

        // SwatchGrid Component
        const SwatchGrid = ({ colors, selectedId, onSelect, lockedIds = [], suggestedOnly = false }) => {
            const [hoveredId, setHoveredId] = React.useState(null);

            const displayColors = React.useMemo(() => {
                if (suggestedOnly) {
                    return colors.filter(color => 
                        ['blonde', 'fashion', 'pastel', 'vibrant'].includes(color.family)
                    );
                }
                return colors;
            }, [colors, suggestedOnly]);

            return (
                <div className="relative">
                    <div className="grid grid-cols-4 md:grid-cols-6 gap-3">
                        {displayColors.map((color) => {
                            const isSelected = selectedId === color.id;
                            const isLocked = lockedIds.includes(color.id);
                            const isHovered = hoveredId === color.id;

                            return (
                                <button
                                    key={color.id}
                                    onClick={() => !isLocked && onSelect(color.id)}
                                    onMouseEnter={() => setHoveredId(color.id)}
                                    onMouseLeave={() => setHoveredId(null)}
                                    disabled={isLocked}
                                    className={`
                                        relative w-12 h-12 rounded-lg border-2 transition-all duration-200
                                        ${isSelected 
                                            ? 'border-purple-500 shadow-lg transform scale-110' 
                                            : 'border-gray-300 hover:border-gray-400'
                                        }
                                        ${isLocked ? 'cursor-not-allowed opacity-60' : 'cursor-pointer hover:scale-105'}
                                    `}
                                    title={color.name}
                                >
                                    <div
                                        className="w-full h-full rounded-md"
                                        style={{ backgroundColor: color.hex }}
                                    />
                                    
                                    {isLocked && (
                                        <div className="absolute inset-0 bg-black bg-opacity-40 rounded-md flex items-center justify-center">
                                            <span className="text-white text-lg">üîí</span>
                                        </div>
                                    )}
                                    
                                    {isSelected && (
                                        <div className="absolute -top-1 -right-1 w-4 h-4 bg-purple-500 rounded-full flex items-center justify-center">
                                            <svg className="w-2.5 h-2.5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                                <path fillRule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clipRule="evenodd" />
                                            </svg>
                                        </div>
                                    )}
                                    
                                    {color.isPremium && !isLocked && (
                                        <div className="absolute -top-1 -left-1 w-4 h-4 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center">
                                            <span className="text-white text-xs">üíé</span>
                                        </div>
                                    )}
                                </button>
                            );
                        })}
                    </div>
                    
                    {hoveredId && (
                        <div className="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-1 bg-black bg-opacity-80 text-white text-sm rounded-lg whitespace-nowrap z-10">
                            {displayColors.find(c => c.id === hoveredId)?.name}
                        </div>
                    )}
                </div>
            );
        };

        // Main ColorStylePicker Component
        const ColorStylePicker = ({ value, onChange, palette, lockedIds = [] }) => {
            const [activeTab, setActiveTab] = React.useState(value.type);
            const [showAdvanced, setShowAdvanced] = React.useState(false);

            React.useEffect(() => {
                setActiveTab(value.type);
            }, [value.type]);

            const suggestedAccents = React.useMemo(() => {
                if (value.type === 'accented' && value.accented?.baseColorId) {
                    return suggestAccents(value.accented.baseColorId);
                }
                return [];
            }, [value.type, value.accented?.baseColorId]);

            const handleTabChange = (tab) => {
                setActiveTab(tab);
                
                if (tab === 'single-tone') {
                    onChange({
                        type: 'single-tone',
                        singleTone: { colorId: 'medium-brown' }
                    });
                } else {
                    onChange({
                        type: 'accented',
                        accented: {
                            baseColorId: 'medium-brown',
                            accentColorId: 'golden-blonde',
                            technique: 'highlights',
                            intensity: 'standard',
                            placement: 'face-framing',
                            blend: 'soft'
                        }
                    });
                }
            };

            const handleAccentedUpdate = (updates) => {
                if (value.type === 'accented' && value.accented) {
                    onChange({
                        type: 'accented',
                        accented: { ...value.accented, ...updates }
                    });
                }
            };

            const currentBaseColor = value.type === 'accented' && value.accented 
                ? palette.find(c => c.id === value.accented.baseColorId)
                : null;

            const currentAccentColor = value.type === 'accented' && value.accented 
                ? palette.find(c => c.id === value.accented.accentColorId)
                : null;

            const contrastRatio = currentBaseColor && currentAccentColor 
                ? getContrast(currentBaseColor.hex, currentAccentColor.hex)
                : 0;

            return (
                <div className="bg-white rounded-xl shadow-lg p-6 max-w-2xl mx-auto">
                    {/* Tab Navigation */}
                    <div className="flex bg-gray-100 rounded-lg p-1 mb-6">
                        <button
                            onClick={() => handleTabChange('single-tone')}
                            className={`flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors ${
                                activeTab === 'single-tone'
                                    ? 'bg-white text-purple-600 shadow-sm'
                                    : 'text-gray-600 hover:text-gray-800'
                            }`}
                        >
                            Single-Tone
                        </button>
                        <button
                            onClick={() => handleTabChange('accented')}
                            className={`flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors ${
                                activeTab === 'accented'
                                    ? 'bg-white text-purple-600 shadow-sm'
                                    : 'text-gray-600 hover:text-gray-800'
                            }`}
                        >
                            Accented
                        </button>
                    </div>

                    {/* Single-Tone Tab */}
                    {activeTab === 'single-tone' && (
                        <div className="space-y-4">
                            <div>
                                <h3 className="text-lg font-semibold mb-3">Choose Your Color</h3>
                                <SwatchGrid
                                    colors={palette}
                                    selectedId={value.singleTone?.colorId}
                                    onSelect={(colorId) => onChange({ type: 'single-tone', singleTone: { colorId } })}
                                    lockedIds={lockedIds}
                                />
                            </div>
                        </div>
                    )}

                    {/* Accented Tab */}
                    {activeTab === 'accented' && (
                        <div className="space-y-6">
                            {/* Base Color */}
                            <div>
                                <h3 className="text-lg font-semibold mb-3">Base Color</h3>
                                <SwatchGrid
                                    colors={palette}
                                    selectedId={value.accented?.baseColorId}
                                    onSelect={(colorId) => handleAccentedUpdate({ baseColorId: colorId })}
                                    lockedIds={lockedIds}
                                />
                            </div>

                            {/* Accent Color */}
                            <div>
                                <h3 className="text-lg font-semibold mb-3">Accent Color</h3>
                                <SwatchGrid
                                    colors={suggestedAccents.length > 0 ? suggestedAccents : palette}
                                    selectedId={value.accented?.accentColorId}
                                    onSelect={(colorId) => handleAccentedUpdate({ accentColorId: colorId })}
                                    lockedIds={lockedIds}
                                    suggestedOnly={true}
                                />
                                
                                {contrastRatio > 0 && (
                                    <div className="mt-2 text-xs text-gray-600">
                                        Contrast ratio: {contrastRatio.toFixed(1)} 
                                        <span className={`ml-2 ${contrastRatio >= 3 ? 'text-green-600' : 'text-yellow-600'}`}>
                                            {contrastRatio >= 5 ? '‚úÖ Excellent' : contrastRatio >= 3 ? '‚úÖ Good' : '‚ö†Ô∏è Low'}
                                        </span>
                                    </div>
                                )}
                            </div>

                            {/* Technique Selection */}
                            <div>
                                <h4 className="text-sm font-medium mb-2">Technique</h4>
                                <div className="grid grid-cols-2 gap-2">
                                    {['highlights', 'lowlights', 'balayage', 'ombre'].map((technique) => (
                                        <button
                                            key={technique}
                                            onClick={() => handleAccentedUpdate({ technique })}
                                            className={`py-2 px-3 text-sm rounded-lg border transition-colors ${
                                                value.accented?.technique === technique
                                                    ? 'border-purple-500 bg-purple-50 text-purple-700'
                                                    : 'border-gray-300 hover:border-gray-400'
                                            }`}
                                        >
                                            {technique.charAt(0).toUpperCase() + technique.slice(1)}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Intensity Control */}
                            <div>
                                <h4 className="text-sm font-medium mb-2">Intensity</h4>
                                <div className="flex bg-gray-100 rounded-lg p-1">
                                    {['subtle', 'standard', 'bold'].map((intensity) => (
                                        <button
                                            key={intensity}
                                            onClick={() => handleAccentedUpdate({ intensity })}
                                            className={`flex-1 py-1 px-2 text-sm rounded-md transition-colors ${
                                                value.accented?.intensity === intensity
                                                    ? 'bg-white text-purple-600 shadow-sm'
                                                    : 'text-gray-600 hover:text-gray-800'
                                            }`}
                                        >
                                            {intensity.charAt(0).toUpperCase() + intensity.slice(1)}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Placement Control */}
                            <div>
                                <h4 className="text-sm font-medium mb-2">Placement</h4>
                                <div className="grid grid-cols-2 gap-2">
                                    {['overall', 'face-framing', 'mid-ends', 'tips'].map((placement) => (
                                        <button
                                            key={placement}
                                            onClick={() => handleAccentedUpdate({ placement })}
                                            className={`py-2 px-3 text-sm rounded-lg border transition-colors ${
                                                value.accented?.placement === placement
                                                    ? 'border-purple-500 bg-purple-50 text-purple-700'
                                                    : 'border-gray-300 hover:border-gray-400'
                                            }`}
                                        >
                                            {placement.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Blend Control */}
                            <div>
                                <h4 className="text-sm font-medium mb-2">Blend</h4>
                                <div className="flex bg-gray-100 rounded-lg p-1">
                                    {['soft', 'defined'].map((blend) => (
                                        <button
                                            key={blend}
                                            onClick={() => handleAccentedUpdate({ blend })}
                                            className={`flex-1 py-1 px-2 text-sm rounded-md transition-colors ${
                                                value.accented?.blend === blend
                                                    ? 'bg-white text-purple-600 shadow-sm'
                                                    : 'text-gray-600 hover:text-gray-800'
                                            }`}
                                        >
                                            {blend.charAt(0).toUpperCase() + blend.slice(1)}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Presets */}
                    <div className="mt-8">
                        <h3 className="text-lg font-semibold mb-4">Popular Presets</h3>
                        <div className="flex space-x-3 overflow-x-auto pb-2">
                            {presets.map((preset) => (
                                <button
                                    key={preset.id}
                                    onClick={() => onChange(preset.choice)}
                                    className="flex-shrink-0 p-3 rounded-lg border text-left min-w-[120px] hover:border-purple-400 transition-colors"
                                >
                                    <div className="text-sm font-medium mb-1">{preset.label}</div>
                                    <div className="text-xs text-gray-600">{preset.description}</div>
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Live Preview */}
                    <div className="mt-6 p-4 bg-gray-50 rounded-lg">
                        <h4 className="text-sm font-medium mb-2">AI Prompt Preview</h4>
                        <p className="text-sm text-gray-700 italic">
                            "{toPrompt(value)}"
                        </p>
                    </div>
                </div>
            );
        };

        // Demo App
        const ColorStyleDemo = () => {
            const [colorChoice, setColorChoice] = React.useState({
                type: 'single-tone',
                singleTone: { colorId: 'medium-brown' }
            });
            const [userIsPremium, setUserIsPremium] = React.useState(false);

            const lockedIds = userIsPremium ? [] : colorPalette.filter(c => c.isPremium).map(c => c.id);

            return (
                <div className="container mx-auto px-4">
                    {/* Header */}
                    <div className="text-center mb-8">
                        <h1 className="text-3xl font-bold text-gray-800 mb-4">
                            Professional Color Style System
                        </h1>
                        <p className="text-gray-600 mb-6">
                            Salon-accurate color selection with single-tone and accented options
                        </p>
                        
                        {/* Premium Toggle */}
                        <div className="inline-flex items-center space-x-3">
                            <span className="text-sm text-gray-600">Free User</span>
                            <button
                                onClick={() => setUserIsPremium(!userIsPremium)}
                                className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${
                                    userIsPremium ? 'bg-purple-600' : 'bg-gray-200'
                                }`}
                            >
                                <span className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${
                                    userIsPremium ? 'translate-x-6' : 'translate-x-1'
                                }`} />
                            </button>
                            <span className="text-sm text-purple-600">Premium User</span>
                        </div>
                    </div>

                    {/* Color Style Picker */}
                    <ColorStylePicker
                        value={colorChoice}
                        onChange={setColorChoice}
                        palette={colorPalette}
                        lockedIds={lockedIds}
                    />

                    {/* Debug Output */}
                    <div className="mt-8 p-4 bg-gray-100 rounded-lg">
                        <h3 className="font-medium mb-2">Debug Output:</h3>
                        <pre className="text-sm text-gray-700 whitespace-pre-wrap overflow-auto">
                            {JSON.stringify(colorChoice, null, 2)}
                        </pre>
                    </div>
                </div>
            );
        };

        // Render the demo
        const root = ReactDOM.createRoot(document.getElementById('color-style-demo'));
        root.render(<ColorStyleDemo />);
    </script>
</body>
</html>
